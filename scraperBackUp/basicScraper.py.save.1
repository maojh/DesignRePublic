

import requests, re
from bs4 import BeautifulSoup
import csv
import sys
import glob, os
from datetime import datetime, date, timedelta

print "starting"
reload(sys)
sys.setdefaultencoding('utf8')

#r = requests.get("https://re.public.polimi.it/handle/11311/1019072?mode=full")
#if r is not None:
#	print "request gone wrong"
#html = "".join(line.strip() for line in r.content.split("\n"))
#soup = BeautifulSoup(html, 'lxml')

#rows = soup.find_all('tr')


content = []
headers = []
values = []
firstPub = ""

with open("pubLink_clean.csv","rb") as f:
	reader = csv.reader(f)
	next(reader, None)
	for pub in reader:
		firstPub = pub
		r = requests.get( pub[0]+'?mode=full' )
		print r.status_code
		html = "".join(line.strip() for line in r.content.split("\n"))
		soup = BeautifulSoup(html,'lxml')
		rows = soup.find_all('tr')
		for i in range(1, len(rows)-6):
			if(i not in [3,4,5]):				#skip some useless fields
				cells = rows[i].find_all('td')
				field = cells[0].string
				headers.append(field)

				value = cells[1].string
				content.append(value)
	#			print field.string + ": " + value.string
		break

print headers
print content

if(len(headers)==len(content)):
	print "ok"
else:
	print "Headers fields: " + str(len(headers)) + " - Values: " + str(len(content))

time  = datetime.now()

fileName = "singolo_" + str(time.day) + "/" + str(time.month) + "_" + str(time.hour) + "_" + str(time.minute) + ".csv"

ofile = open(fileName,"wb")

writer = csv.writer(ofile,delimiter=",")
writer.writerow(headers)
write
r.writerow(content)

rfile
#with open(fileName,"rb") as fr:
#	reader = csv.reader(fr)
#	for row in reader:
#		print row

